<!DOCTYPE html>
<html>
<head>
    <title>🏪 Dundalk Market - Shop Local</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background: #f8f9fa; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 10px; margin-bottom: 30px; }
        .store-card { background: white; border-radius: 10px; padding: 20px; margin: 15px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .product { background: #f8f9fa; padding: 10px; margin: 8px 0; border-radius: 5px; border-left: 4px solid #667eea; }
        button { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background: #5a67d8; }
        #output { margin-top: 30px; }
        .loading { color: #666; font-style: italic; }
    </style>
</head>
<body>
    <header>
        <h1>🏪 Dundalk Market</h1>
        <p>Digital Main Street • Shop Local Dundalk Businesses Online</p>
        <p><small>Powered by your local API: <code id="api-status">Testing connection...</code></small></p>
    </header>
    
    <div>
        <h2>Explore Local Businesses</h2>
        <button onclick="loadAllStores()">Browse All Stores</button>
        <button onclick="loadAllProducts()">View All Products</button>
        <button onclick="loadDPL()">DPL Engineering</button>
        <button onclick="testCheckout()">Simulate Purchase</button>
    </div>
    
    <div id="output">
        <p class="loading">Click a button above to load data...</p>
    </div>
    
    <script>
        const API_URL = 'http://127.0.0.1:8000';
        
        async function loadAllStores() {
            showLoading('Loading Dundalk stores...');
            try {
                const response = await fetch(API_URL + '/stores');
                const data = await response.json();
                displayStores(data.stores);
                updateAPIStatus('✅ Connected');
            } catch (error) {
                showError('Could not load stores. Make sure the API is running.');
            }
        }
        
        async function loadAllProducts() {
            showLoading('Loading all products...');
            try {
                const response = await fetch(API_URL + '/products');
                const data = await response.json();
                displayProducts(data.products);
            } catch (error) {
                showError('Could not load products.');
            }
        }
        
        async function loadDPL() {
            showLoading('Loading DPL Engineering...');
            try {
                const response = await fetch(API_URL + '/stores/1');
                const data = await response.json();
                displayStoreDetail(data);
            } catch (error) {
                showError('Could not load DPL Engineering.');
            }
        }
        
        function testCheckout() {
            const output = document.getElementById('output');
            output.innerHTML = `
                <div class="store-card">
                    <h3>🛒 Simulated Checkout</h3>
                    <p>Order: <strong>Steel Bolts (Pack of 50)</strong> from DPL Engineering</p>
                    <p>Price: <strong>€24.99</strong></p>
                    <p>Pickup: <strong>Dundalk Industrial Estate</strong></p>
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 5px; margin: 15px 0;">
                        <p>💰 <strong>Payment Flow:</strong></p>
                        <p>1. Customer pays €24.99 via Stripe</p>
                        <p>2. Stripe takes 1.4% + €0.25 = €0.60</p>
                        <p>3. Platform takes 12% commission = €3.00</p>
                        <p>4. DPL Engineering receives = €21.39</p>
                    </div>
                    <button onclick="alert('In real version: Stripe checkout would open here!')">
                        Proceed to Payment
                    </button>
                </div>
            `;
        }
        
        function displayStores(stores) {
            const output = document.getElementById('output');
            output.innerHTML = `<h2>${stores.length} Local Stores</h2>`;
            
            stores.forEach(store => {
                output.innerHTML += `
                    <div class="store-card">
                        <h3>${store.name}</h3>
                        <p>📍 ${store.address}</p>
                        <p>${store.description}</p>
                        <p><strong>Products available:</strong> ${store.products.length}</p>
                        <button onclick="viewStore(${store.id})">View Store</button>
                    </div>
                `;
            });
        }
        
        function displayProducts(products) {
            const output = document.getElementById('output');
            output.innerHTML = `<h2>${products.length} Local Products</h2>`;
            
            products.forEach(product => {
                output.innerHTML += `
                    <div class="product">
                        <strong>${product.name}</strong>
                        <div>Price: €${product.price}</div>
                        <div>Store: ${product.store_name}</div>
                        <button onclick="simulateAddToCart(${product.id}, '${product.name}', ${product.price})">
                            Add to Cart
                        </button>
                    </div>
                `;
            });
        }
        
        function displayStoreDetail(store) {
            const output = document.getElementById('output');
            output.innerHTML = `
                <div class="store-card">
                    <h2>${store.name}</h2>
                    <p><strong>Category:</strong> ${store.category}</p>
                    <p><strong>Address:</strong> ${store.address}</p>
                    <p>${store.description}</p>
                    
                    <h3>Available Products:</h3>
                    ${store.products.map(product => `
                        <div class="product">
                            <strong>${product.name}</strong>
                            <div>€${product.price} • ${product.category}</div>
                            <button onclick="simulateAddToCart(${product.id}, '${product.name}', ${product.price})">
                                Add to Cart (€${product.price})
                            </button>
                        </div>
                    `).join('')}
                    
                    <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 5px;">
                        <p><strong>💰 Business Model Preview:</strong></p>
                        <p>If this store sells €1000 through Dundalk Market:</p>
                        <p>• Store keeps: <strong>€880</strong></p>
                        <p>• Platform commission (12%): <strong>€120</strong></p>
                        <p>• Supporting local economy: <strong>Priceless</strong></p>
                    </div>
                </div>
            `;
        }
        
        function simulateAddToCart(productId, productName, price) {
            alert(`Added to cart: ${productName} (€${price})\n\nNext: Integrated Stripe checkout would open`);
        }
        
        function viewStore(storeId) {
            showLoading(`Loading store #${storeId}...`);
            fetch(API_URL + '/stores/' + storeId)
                .then(r => r.json())
                .then(data => displayStoreDetail(data))
                .catch(e => showError('Could not load store'));
        }
        
        function showLoading(message) {
            document.getElementById('output').innerHTML = `<p class="loading">${message}...</p>`;
        }
        
        function showError(message) {
            document.getElementById('output').innerHTML = `<p style="color: #d32f2f;">❌ ${message}</p>`;
        }
        
        function updateAPIStatus(message) {
            document.getElementById('api-status').textContent = message;
        }
        
        // Test API connection on page load
        fetch(API_URL)
            .then(r => r.json())
            .then(data => {
                updateAPIStatus('✅ Connected to: ' + data.message);
            })
            .catch(e => {
                updateAPIStatus('❌ API not connected');
            });
    </script>
</body>
</html>
